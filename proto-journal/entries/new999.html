<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>[Nationwide Emergency Web System] - Proto Journal</title>
  <link rel="stylesheet" href="../style/journal.css">
</head>
<body>

  <!-- Metadata Block -->
  <div class="meta-block">
    <meta name="title" content="Nationwide Emergency Web System">
    <meta name="date" content="2025-11-25">
    <meta name="type" content="System Architecture / Product Design">
    <meta name="abstract" content="这是一个建立在 Web 技术（Vue + Node.js + PostgreSQL）上的全国紧急联动系统，具备最高级别的数据保护、零信任网络、分布式架构以及可承载全国性灾害流量的弹性能力。普通用户可通过网页发出求助，紧急部门通过同一 Web 后台查看、接单与处理事件。本方案包括概念、系统设计、开发计划、硬件要求、经费估算与潜在应用场景。">
  </div>

  <!-- Auto-generated title -->
  <h1></h1>

  <!-- Auto-filled meta -->
  <div class="meta"></div>

  <h2>Abstract</h2>
  <p id="auto-abstract"></p>

  <h2>Sample Layout</h2>
  <p><a href="/tool/new999/user.html" target="_blank">User Interface</a></p>
  <p><a href="/tool/new999/department.html" target="_blank">Department Interface</a></p>

  <h2>Observations</h2>
  <ul>
    <li>传统紧急系统（999/112）主要依赖电话，不具备事件图片、视频、GPS 定位等数字化能力。</li>
    <li>全国紧急部门间系统标准不一致，调度信息难以共享。</li>
    <li>灾害期间，高峰流量可能导致系统拥塞或服务降级。</li>
    <li>政府机构普遍担心数据泄露，因此数据保护等级必须高于一般商业产品。</li>
    <li>Web 技术已经足够强大，Vue + Node 结合 Cloudflare 可在零暴露架构中安全运行。</li>
    <li>OTP（Email + Phone）能确保用户来源真实，提高事件可信度。</li>
    <li>高流量写入必须依靠 Redis 队列（Queue）做流量削峰，以保护数据库。</li>
    <li>紧急部门只需要简单的 Dashboard，不需要复杂的 native app。</li>
  </ul>

  <h2>Hypotheses</h2>
  <ul>
    <li>如果建立全国统一 Web 平台，能显著提高事件分派速度（比电话描述更快）。</li>
    <li>如果用户提交照片、位置与事件类型，部门调度效率会提升 20–40%。</li>
    <li>如果采用零信任 Cloudflare Tunnel，可以完全避免 API 和 DB 的公网暴露。</li>
    <li>如果所有敏感字段采用 AES-256 字段加密，即便数据库泄漏也无法读取内容。</li>
    <li>如果采用 Redis Stream 作为事件队列，系统在灾害高峰仍可保持稳定。</li>
    <li>全国级别流量可通过 Kubernetes + 分布式数据库扩展。</li>
    <li>部门采用 RBAC（角色权限）后，可确保区域部门只能查看其区域事件，避免越权。</li>
  </ul>

  <h2>Images</h2>
  <img src="./img/new999.png" alt="System Architecture Diagram" style="max-width: 100%; height: auto;">

  <h2>Notes</h2>
  <p>
    以下为系统完整内容，包括技术、架构、用户流程、部门流程、硬件规格、经费预算、时间线规划、风险控制与扩展路线。
  </p>

  <h3>1. 系统概念（Concept）</h3>
  <p>
    使用 Web 技术构建全国紧急部门联动系统，让用户可在浏览器发出求助，并让警察、消防与医疗部门在同一平台查看与处理事件。所有敏感数据采用最高等级加密，并以零信任架构保护整个系统免受攻击。目标是在常态、高峰与灾害级事件中都能维持系统稳定。
  </p>

  <h3>2. 核心模块（Modules）</h3>
  <ul>
    <li>用户门户（HTML）：注册、Email/Phone OTP、GPS 定位、事件上传（图/视频）。</li>
    <li>部门 Dashboard（HTML）：事件查看、地图、接单、进度更新、备注。</li>
    <li>事件 API（Node.js）：处理事件流、分派、队列写入。</li>
    <li>Redis Stream：事件队列（高峰保护）。</li>
    <li>PostgreSQL：主要数据储存（字段级加密）。</li>
    <li>对象储存（MinIO/S3）：媒体文件加签名存储。</li>
    <li>Cloudflare Zero Trust：整个系统的封闭式入口、防护层。</li>
  </ul>

  <h3>3. 数据保护（最高级别）</h3>
  <ul>
    <li>Zero Trust 架构（Cloudflare Tunnel，API/DB 不暴露公网）。</li>
    <li>AES-256-GCM 字段级加密（姓名、电话、地址、事件描述）。</li>
    <li>密码用 bcrypt 存储（不可逆）。</li>
    <li>JWT（ES256）+ Session Binding 提升登录安全。</li>
    <li>RBAC 权限控制（部门区域隔离）。</li>
    <li>WORM 日志存证（Write Once Read Many）。</li>
  </ul>

  <h3>4. 用户流程（User Flow）</h3>
  <ol>
    <li>用户注册 → Email OTP → Phone OTP。</li>
    <li>进入系统 → 点击“一键求助”。</li>
    <li>系统自动获取位置。</li>
    <li>上传照片/视频（可选）。</li>
    <li>系统将事件写入 Redis Queue。</li>
    <li>后台 Worker 处理 → 写入数据库。</li>
  </ol>

  <h3>5. 部门流程（Department Flow）</h3>
  <ol>
    <li>部门账号登录 Dashboard。</li>
    <li>按区域收到事件。</li>
    <li>查看地图定位、照片、备注。</li>
    <li>点击“接单”。</li>
    <li>行动并更新状态（处理中、已完成）。</li>
    <li>关闭事件。</li>
  </ol>

  <h3>6. 系统架构（Architecture）</h3>
  <ul>
    <li>Cloudflare（WAF + L7/L3 DDoS + Zero Trust + Tunnel）</li>
    <li>Load Balancer：双活（HAProxy / Envoy）</li>
    <li>Node.js API 集群：25 个实例（容器化 / Kubernetes）</li>
    <li>Redis Cluster：6 节点（3 主 3 从）用于 OTP、Session、事件队列</li>
    <li>PostgreSQL 分布式集群：9 节点（3 分片 × 主/从/热备）</li>
    <li>对象储存（MinIO Distributed）：8 节点（4+4 EC）</li>
    <li>监控/日志：Prometheus + Grafana + Loki + Elastic（总 5 节点）</li>
  </ul>

  <p>
  系统采用全国级事件冲击模型设计，重点在：
  </p>
  <ul>
    <li>事件写入不丢失（Redis Stream + DB Bulk Writer）</li>
    <li>全国 50k RPS 峰值（灾难场景）持续 60 秒不崩溃</li>
    <li>硬件故障可容忍（任意两个节点故障不影响服务）</li>
    <li>所有 API、DB 均不暴露公网（零暴露）</li>
    <li>文件存储具备横向扩容能力（证据媒体最大 200TB）</li>
  </ul>

  <p>
  该架构支持：
  </p>
  <ul>
    <li>最高并发：640,000 用户（2% 全国人口同时上线）</li>
    <li>峰值 50,000 RPS Web/API 流量</li>
    <li>事件写入能力：每秒 18,000～22,000 条</li>
    <li>对象存储吞吐量：500MB～1GB/s 峰值</li>
  </ul>

  <h3>7. 硬件与经费（Budget）</h3>

  <p>
  经费以完全写实为目标，基于 2025 年马来西亚服务器市场价格、10G 网络与企业 UPS 标准估算。
  </p>

  <h4>7.1 物理服务器需求（共 57 个逻辑节点 / 10–14 台物理机）</h4>

  <table border="1" cellpadding="6" style="border-collapse: collapse; width: 100%;">
    <tr>
      <th>模块</th>
      <th>节点数量</th>
      <th>推荐硬件</th>
      <th>说明</th>
    </tr>

    <tr>
      <td>Node.js API</td>
      <td>25 实例</td>
      <td>容器跑在 4 台物理机上<br>EPYC 7313 / 64–128GB RAM / NVMe RAID</td>
      <td>提供 50k RPS 吞吐的核心计算集群</td>
    </tr>

    <tr>
      <td>Redis Cluster</td>
      <td>6 节点（3 主 3 从）</td>
      <td>2 台物理机（多 VM）<br>高频 CPU + NVMe</td>
      <td>OTP、Session、事件队列，最高 300k ops/sec</td>
    </tr>

    <tr>
      <td>PostgreSQL（分片）</td>
      <td>9 节点（3 分片 × 3）</td>
      <td>4 台物理机（多 VM）<br>ECC RAM / RAID10 NVMe</td>
      <td>分散全国写入压力，单分片支持 2k writes/sec</td>
    </tr>

    <tr>
      <td>MinIO（对象存储）</td>
      <td>8 节点</td>
      <td>4 台物理机（混合 SSD+HDD）</td>
      <td>媒体文件高可用，4+4 EC，能容忍两个节点失败</td>
    </tr>

    <tr>
      <td>负载平衡（LB）</td>
      <td>2 节点</td>
      <td>1 台物理机（双 VM）</td>
      <td>HAProxy / Envoy active-active</td>
    </tr>

    <tr>
      <td>监控/日志</td>
      <td>5 节点</td>
      <td>1 台物理机</td>
      <td>Prometheus + Grafana + Loki + Elastic</td>
    </tr>

    <tr>
      <td>管理与备援</td>
      <td>1–2 节点</td>
      <td>1 台物理机</td>
      <td>运维/跳板/CI/CD 等服务</td>
    </tr>
  </table>

  <h4>7.2 实体硬件成本（马来西亚 2025 市场价）</h4>

  <ul>
    <li>高性能服务器（10–14 台）  
        RM 80,000 – RM 110,000 之间每台  
        → 合计约 <b>RM 1,000,000 – RM 1,300,000</b></li>

    <li>10G 企业交换机（4 台）  
        RM 40,000 – RM 60,000</li>

    <li>机柜（42U × 2）  
        RM 6,000 – RM 10,000</li>

    <li> UPS 系统（双套，支持 30 分钟）  
        RM 30,000 – RM 45,000</li>

    <li>电力布线 + 散热（机房）  
        RM 15,000 – RM 30,000</li>

    <li>Cloudflare Enterprise（年费）  
        RM 40,000 – RM 60,000</li>

    <li>SMS + Email OTP（年）  
        RM 20,000 – RM 40,000（按灾害频率）</li>
  </ul>

  <p>
  <b>总预算（最写实、全国灾害可承载）</b>：
  </p>

  <h3 style="color:#b30000">RM 1.2 million – RM 1.5 million</h3>

  <p>
  此数字为真实可执行的全国级灾害负载建设成本，下探空间有限，因为吞吐、写入能力、对象存储、Redis、PG 分片等都是全国性策略必需成本。
  </p>

  <h4>7.3 实际抗压结果（模拟值）</h4>

  <ul>
    <li>系统可承载：<b>50,000 RPS 峰值（60 秒）</b></li>
    <li>并发用户：<b>640,000（2% 全国人口）</b></li>
    <li>事件写入：<b>每秒 18k–22k 条</b></li>
    <li>事件高峰堆积容量（Redis Stream）：<b>100–150 万事件</b></li>
    <li>对象存储吞吐：<b>1GB/s 峰值上传</b></li>
    <li>数据库每秒写入：<b>6k writes/sec（3 分片）</b></li>
  </ul>

  <p>
  此架构的目标是：在全国级突发事件下（例如大停电、全国暴雨、烟霾危机），系统依然不会崩溃、不丢事件、不影响用户求助成功率。
  </p>

  <h3>8. 开发技术（Tech Stack）</h3>
  <ul>
    <li>前端：HTML + Bootstrap + Javascript</li>
    <li>后端：Node.js (Express)</li>
    <li>数据库：PostgreSQL</li>
    <li>队列：Redis</li>
    <li>储存：MinIO/S3</li>
    <li>基础架构：Cloudflare</li>
    <li>部署：Docker</li>
  </ul>

  <h3>9. 开发时间表（Timeline）</h3>
  <ul>
    <li>第 1–2 周：系统设计、数据库 Schema、前后端框架初始化。</li>
    <li>第 3–6 周：用户端、部门端主功能开发。</li>
    <li>第 7–10 周：事件队列、媒体上传、地图模块开发。</li>
    <li>第 11–12 周：安全加固、渗透测试、压测。</li>
    <li>第 13–14 周：试点上线（一个城市）。</li>
  </ul>

  <h3>10. 风险评估</h3>
  <ul>
    <li>政府部门采用速度不一 → 先做区域试点。</li>
    <li>系统在灾害高峰可能出现堆积 → Redis Queue 吸收峰值。</li>
    <li>权限滥用 → RBAC + 审计日志（不可删）。</li>
    <li>数据泄露风险 → AES-256 字段加密 + 零信任网络。</li>
  </ul>

  <h3>11. 扩展应用（Future Expansion）</h3>
  <ul>
    <li>与医院/警察信息系统联动。</li>
    <li>加入 AI 事件自动分类。</li>
    <li>加入灾害预测图层（气象、水灾）。</li>
    <li>手机 PWA 版本（接近 App 使用体验）。</li>
  </ul>

  <h2>Potential Applications</h2>
  <ul>
    <li>全国统一紧急报警入口（One National Portal）。</li>
    <li>大型活动（跨年、运动会）即时调度。</li>
    <li>应急灾害统一管理平台。</li>
    <li>警消医疗跨部门合作系统。</li>
  </ul>

  <script src="../script/entries.js"></script>
</body>
</html>
